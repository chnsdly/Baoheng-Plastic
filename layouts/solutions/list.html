{{ define "main" }}
<section class="industries-listing blog-classic" aria-labelledby="industries-listing-heading">
  <div class="industries-listing__container container">
    <div class="industries-listing__layout">

      <!-- 主列：行业案例列表 -->
      <div class="industries-listing__main">
        <header class="industries-listing__header">
          <h1 class="industries-listing__title" id="industries-listing-heading">{{ .Title }}</h1>
          {{ with .Params.description }}
            <p class="industries-listing__description">{{ . }}</p>
          {{ end }}
        </header>

        {{ $pgr := .Paginate (.RegularPagesRecursive.ByDate.Reverse) }}

        <ul class="industries-listing__items" role="list">
          {{ range $p := $pgr.Pages }}
            {{/* --------- 计算封面 --------- */}}
            {{ $cover := cond (isset $p.Params "cover_image") $p.Params.cover_image (cond (isset $p.Params "cover") (index $p.Params "cover" "image") nil) }}

            {{/* --------- CTA 文案：固定为“阅读” --------- */}}
            {{ $cta := "阅读" }}

            <li class="industries-listing__item">
              <article class="industry-card">
                <a class="industry-card__media" href="{{ $p.RelPermalink }}" aria-label="{{ $p.Title }}">
                  {{ with $cover }}
                    <img class="industry-card__img" src="{{ . | relURL }}" alt="{{ $p.Title }}" loading="lazy" decoding="async">
                  {{ else }}
                    <span class="industry-card__placeholder" aria-hidden="true"></span>
                  {{ end }}
                </a>

                <div class="industry-card__content">
                  <h2 class="industry-card__title">
                    <a class="industry-card__link" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
                  </h2>

                  <p class="industry-card__summary">
                    {{- with $p.Params.description -}}
                      {{ . }}
                    {{- else -}}
                      {{- $txt := $p.Summary | plainify -}}
                      {{- if lt (len $txt) 10 }}{{ $txt = (truncate 200 ($p.Plain | plainify)) }}{{ end -}}
                      {{- $txt -}}
                    {{- end -}}
                  </p>

                  {{ $cat := lower (printf "%v" $p.Params.categories) }}
                  {{ $isDL := or (eq $cat "download") (eq $cat "downloads") }}
                  {{ $catLabelMap := dict "articles" "Articles" "download" "Download" "downloads" "Download" "news" "News" "faq" "FAQ" }}

                  <ul class="industry-card__meta" role="list">
                    <li class="industry-card__meta-item">
                      <span class="industry-card__meta-label">{{ if eq $.Site.Language.Lang "zh" }}分类{{ else }}Category{{ end }}</span>
                      <span class="industry-card__meta-text">{{ or (index $catLabelMap $cat) $cat }}</span>
                    </li>

                    {{ if not $isDL }}
                      {{ $rt := cond (gt $p.ReadingTime 0) (printf "%d 分钟" $p.ReadingTime) "" }}
                      {{ with or $p.Params.reading $rt }}
                        <li class="industry-card__meta-item">
                          <span class="industry-card__meta-label">{{ if eq $.Site.Language.Lang "zh" }}阅读{{ else }}Reading{{ end }}</span>
                          <span class="industry-card__meta-text">{{ . }}</span>
                        </li>
                      {{ end }}
                    {{ end }}

                    {{ if $isDL }}
                      {{ with $p.Params.file_size }}
                        <li class="industry-card__meta-item">
                          <span class="industry-card__meta-label">{{ if eq $.Site.Language.Lang "zh" }}文件{{ else }}File{{ end }}</span>
                          <span class="industry-card__meta-text">{{ . }}</span>
                        </li>
                      {{ end }}
                    {{ end }}

                    <li class="industry-card__meta-item">
                      <span class="industry-card__meta-label">{{ if eq $.Site.Language.Lang "zh" }}发布{{ else }}Published{{ end }}</span>
                      <time class="industry-card__meta-text" datetime="{{ ($p.Date | time).Format "2006-01-02" }}">
                        {{ if eq $.Site.Language.Lang "zh" }}
                          {{ ($p.Date | time).Format "2006-01-02" }}
                        {{ else }}
                          {{ ($p.Date | time).Format "Jan 2, 2006" }}
                        {{ end }}
                      </time>
                    </li>
                  </ul>

                  <div class="industry-card__actions">
                    <a class="industry-card__button button" href="{{ $p.RelPermalink }}">{{ $cta }}</a>
                  </div>
                </div>
              </article>
            </li>
          {{ end }}
        </ul>

        {{ if gt $pgr.TotalPages 1 }}
          <nav class="industries-listing__pager" aria-label="分页导航">
            {{ if $pgr.HasPrev }}
              <a class="industries-listing__pager-btn" href="{{ $pgr.Prev.URL }}">{{ if eq $.Site.Language.Lang "zh" }}上一页{{ else }}Previous{{ end }}</a>
            {{ else }}
              <span class="industries-listing__pager-btn is-disabled" aria-disabled="true">{{ if eq $.Site.Language.Lang "zh" }}上一页{{ else }}Previous{{ end }}</span>
            {{ end }}

            {{ range $pg := $pgr.Pagers }}
              <a class="industries-listing__pager-num {{ if eq $pg.PageNumber $pgr.PageNumber }}is-active{{ end }}" href="{{ $pg.URL }}">{{ $pg.PageNumber }}</a>
            {{ end }}

            {{ if $pgr.HasNext }}
              <a class="industries-listing__pager-btn" href="{{ $pgr.Next.URL }}">{{ if eq $.Site.Language.Lang "zh" }}下一页{{ else }}Next{{ end }}</a>
            {{ else }}
              <span class="industries-listing__pager-btn is-disabled" aria-disabled="true">{{ if eq $.Site.Language.Lang "zh" }}下一页{{ else }}Next{{ end }}</span>
            {{ end }}
          </nav>
        {{ end }}
      </div>

      <!-- 侧边栏：热门、分类、标签 -->
      <aside class="industries-sidebar" aria-label="{{ if eq $.Site.Language.Lang "zh" }}行业案例侧边栏{{ else }}Industries sidebar{{ end }}">
        {{/* 热门文章：优先手动 popular:true，否则回退最新 */}}
        {{ $limit := or .Site.Params.blog.popular.limit 4 }}
        {{ $all := .CurrentSection.RegularPagesRecursive }}
        {{ $pp := where $all "Params.popular" true }}
        {{ if gt (len $pp) 0 }}{{ $pp = first $limit ($pp.ByDate.Reverse) }}{{ else }}{{ $pp = first $limit ($all.ByDate.Reverse) }}{{ end }}
        {{ if gt (len $pp) 0 }}
          <section class="industries-sidebar__widget industries-sidebar__widget--popular" aria-labelledby="industries-popular-heading">
            <h2 class="industries-sidebar__heading" id="industries-popular-heading">{{ if eq $.Site.Language.Lang "zh" }}热门{{ else }}Popular{{ end }}</h2>
            <ul class="industries-sidebar__list" role="list">
              {{ range $it := $pp }}
                <li class="industries-sidebar__list-item">
                  <a class="industries-sidebar__popular-link" href="{{ $it.RelPermalink }}">
                    <span class="industries-sidebar__thumbnail">
                      {{ with $it.Params.cover_image }}
                        <img class="industries-sidebar__thumb-img" src="{{ . | relURL }}" alt="{{ $it.Title }}" loading="lazy" decoding="async">
                      {{ else }}
                        <span class="industries-sidebar__thumb-placeholder" aria-hidden="true"></span>
                      {{ end }}
                    </span>
                    <span class="industries-sidebar__text-group">
                      <span class="industries-sidebar__item-title">{{ $it.Title }}</span>
                      <span class="industries-sidebar__item-summary">
                        {{ with $it.Params.description }}{{ . }}{{ else }}{{ $it.Summary | plainify }}{{ end }}
                      </span>
                    </span>
                  </a>
                </li>
              {{ end }}
            </ul>
          </section>
        {{ end }}

        {{/* 栏目（Sections） */}}
        {{ $root := $.Site.GetPage "section" .Section }}
        {{ if and $root (gt (len $root.Sections) 0) }}
          <nav class="industries-sidebar__widget industries-sidebar__widget--sections" aria-labelledby="industries-sections-heading">
            <h2 class="industries-sidebar__heading" id="industries-sections-heading">{{ if eq $.Site.Language.Lang "zh" }}分类{{ else }}Sections{{ end }}</h2>
            <ul class="industries-sidebar__chips" role="list">
              <li class="industries-sidebar__chip-item">
                <a class="industries-sidebar__chip {{ if eq $.RelPermalink $root.RelPermalink }}is-active{{ end }}" href="{{ $root.RelPermalink }}">
                  <span class="industries-sidebar__chip-label">{{ if eq $.Site.Language.Lang "zh" }}全部{{ else }}All{{ end }}</span>
                  <span class="industries-sidebar__chip-count">{{ len $root.RegularPagesRecursive }}</span>
                </a>
              </li>
              {{ range $sec := $root.Sections }}
                <li class="industries-sidebar__chip-item">
                  <a class="industries-sidebar__chip {{ if eq $.RelPermalink $sec.RelPermalink }}is-active{{ end }}" href="{{ $sec.RelPermalink }}">
                    <span class="industries-sidebar__chip-label">{{ $sec.Title }}</span>
                    <span class="industries-sidebar__chip-count">{{ len $sec.RegularPagesRecursive }}</span>
                  </a>
                </li>
              {{ end }}
            </ul>
          </nav>
        {{ end }}

        {{/* 标签云 */}}
        {{ with site.Taxonomies.tags }}
          <section class="industries-sidebar__widget industries-sidebar__widget--tags" aria-labelledby="industries-tags-heading">
            <h2 class="industries-sidebar__heading" id="industries-tags-heading">{{ if eq $.Site.Language.Lang "zh" }}标签{{ else }}Tags{{ end }}</h2>
            <div class="industries-sidebar__tags">
              {{ range first 20 (sort . "Count" "desc") }}
                <a class="industries-sidebar__tag" href="{{ .Page.RelPermalink }}">#{{ .Page.Title }}</a>
              {{ end }}
            </div>
          </section>
        {{ end }}
      </aside>

    </div>
  </div>
</section>
{{ end }}
